!function(){function e(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function r(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var l=0,o=function(){function t(n,i,r){e(this,t);var l=document.createElement("div");l.classList.add("field-cell"),n.append(l),this.x=i,this.y=r,this.score=0,this.gameScore=document.querySelector(".game-score")}return n(t,[{key:"linkTile",value:function(e){e.setXY(this.x,this.y),this.linkedTile=e}},{key:"unlinkTile",value:function(){this.linkedTile=null}},{key:"isEmpty",value:function(){return!this.linkedTile}},{key:"makeAnEmpty",value:function(){return l=0,this.gameScore.innerHTML=l,this.linkedTile=null}},{key:"linkTileForMerge",value:function(e){e.setXY(this.x,this.y),this.linkedTileForMerge=e}},{key:"unlinkTileForMerge",value:function(){this.linkedTileForMerge=null}},{key:"hasTileForMerge",value:function(){return!!this.linkedTileForMerge}},{key:"canAccept",value:function(e){return this.isEmpty()||!this.hasTileForMerge()&&this.linkedTile.value===e.value}},{key:"mergeTiles",value:function(){if(this.linkedTile){var e=this.linkedTile.value+this.linkedTileForMerge.value;this.linkedTile.setValue(e),this.score+=e,l<this.score&&(console.log(this.score),l=this.score,this.gameScore.textContent=l),e>=2048&&document.querySelector(".message-win").classList.toggle("hidden"),this.linkedTileForMerge.removeFromDOM(),this.unlinkTileForMerge()}}}]),t}(),s={2:"#eee4da",4:"#ede0c8",8:"#f2b179",16:"#f59563",32:"#f67c5f",64:"#f65e3b",128:"#edcf72",256:"#edcc61",512:"#edc850",1024:"#edc53f",2048:"#edc22e"},u=function(){function t(n){e(this,t),this.tileElement=document.createElement("div"),this.tileElement.classList.add("tile"),this.setValue(Math.random()>.5?2:4),n.append(this.tileElement)}return n(t,[{key:"setValue",value:function(e){this.value=e,this.tileElement.textContent=e,this.tileElement.style.setProperty("--bg-color","".concat(s[e])),this.tileElement.style.setProperty("--text-color","".concat(e>=8?"#f9f6f2":"#776e65"))}},{key:"setXY",value:function(e,t){this.x=e,this.y=t,this.tileElement.style.setProperty("--x",e),this.tileElement.style.setProperty("--y",t)}},{key:"removeFromDOM",value:function(){this.tileElement.remove()}},{key:"waitForTransitionEnd",value:function(){var e=this;return new Promise(function(t){e.tileElement.addEventListener("transitionend",t,{once:!0})})}},{key:"waitForAnimationEnd",value:function(){var e=this;return new Promise(function(t){e.tileElement.addEventListener("animationend",t,{once:!0})})}}]),t}(),c=function(){function t(n){e(this,t),this.cells=[];for(var i=0;i<16;i++)this.cells.push(new o(n,i%4,Math.floor(i/4)));this.score=0,this.cellsGroupedByColumn=this.groupCellsByColumn(),this.cellsGroupedByReversedColumn=this.cellsGroupedByColumn.map(function(e){return r(e).reverse()}),this.cellsGroupedByRow=this.groupCellsByRow(),this.cellsGroupedByReversedRow=this.cellsGroupedByRow.map(function(e){return r(e).reverse()})}return n(t,[{key:"getRandomEmptyCell",value:function(){var e=this.cells.filter(function(e){return e.isEmpty()}),t=Math.floor(Math.random()*e.length);return e[t]}},{key:"groupCellsByColumn",value:function(){return this.cells.reduce(function(e,t){return e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e},[])}},{key:"groupCellsByRow",value:function(){return this.cells.reduce(function(e,t){return e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e},[])}},{key:"moveUp",value:function(){this.slideTiles(this.cellsGroupedByColumn)}},{key:"moveDown",value:function(){this.slideTiles(this.cellsGroupedByReversedColumn)}},{key:"moveLeft",value:function(){this.slideTiles(this.cellsGroupedByRow)}},{key:"moveRight",value:function(){this.slideTiles(this.cellsGroupedByReversedRow)}},{key:"canMoveUp",value:function(){return this.canMove(this.cellsGroupedByColumn)}},{key:"canMoveDown",value:function(){return this.canMove(this.cellsGroupedByReversedColumn)}},{key:"canMoveLeft",value:function(){return this.canMove(this.cellsGroupedByRow)}},{key:"canMoveRight",value:function(){return this.canMove(this.cellsGroupedByReversedRow)}},{key:"canMove",value:function(e){var t=this;return e.some(function(e){return t.canMoveInGroup(e)})}},{key:"canMoveInGroup",value:function(e){return e.some(function(t,n){return!(0===n||t.isEmpty())&&e[n-1].canAccept(t.linkedTile)})}},{key:"slideTiles",value:function(e){var t=this,n=[];e.forEach(function(e){return t.slideTilesInGroup(e,n)}),Promise.all(n),this.cells.forEach(function(e){e.hasTileForMerge()&&e.mergeTiles()})}},{key:"slideTilesInGroup",value:function(e,t){for(var n=1;n<e.length;n++)if(!e[n].isEmpty()){for(var i=e[n],r=void 0,l=n-1;l>=0&&e[l].canAccept(i.linkedTile);)r=e[l],l--;r&&(t.push(i.linkedTile.waitForTransitionEnd()),r.isEmpty()?r.linkTile(i.linkedTile):r.linkTileForMerge(i.linkedTile),i.unlinkTile())}}},{key:"start",value:function(e){this.getRandomEmptyCell().linkTile(new u(e)),this.getRandomEmptyCell().linkTile(new u(e))}},{key:"restart",value:function(){document.querySelectorAll(".tile").forEach(function(e){e.remove()}),this.cells.forEach(function(e){return e.unlinkTile()})}}]),t}(),a=document.getElementById("game-field"),f=document.querySelector(".message-lose"),h=document.querySelector(".message-start"),d=new c(a);function y(){document.addEventListener("keydown",v,{once:!0})}function v(e){switch(e.key){case"ArrowUp":if(!d.canMoveUp()){y();return}d.moveUp();break;case"ArrowDown":if(!d.canMoveDown()){y();return}d.moveDown();break;case"ArrowLeft":if(!d.canMoveLeft()){y();return}d.moveLeft();break;case"ArrowRight":if(!d.canMoveRight()){y();return}d.moveRight();break;default:y();return}var t=new u(a);if(d.getRandomEmptyCell().linkTile(t),!d.canMoveUp()&&!d.canMoveDown()&&!d.canMoveLeft()&&!d.canMoveRight()){t.waitForAnimationEnd(),f.classList.toggle("hidden");return}y()}var m=document.querySelector(".button");m.addEventListener("click",function(){m.classList.contains("start")?(d.start(a),y(),m.classList.replace("start","restart"),m.textContent="Restart"):(d.restart(),m.classList.replace("restart","start"),m.textContent="Start"),h.classList.toggle("hidden")})}();
//# sourceMappingURL=index.3aff1042.js.map

let e=0;class t{constructor(e,t,l){let i=document.createElement("div");i.classList.add("field-cell"),e.append(i),this.x=t,this.y=l,this.score=0,this.gameScore=document.querySelector(".game-score")}linkTile(e){e.setXY(this.x,this.y),this.linkedTile=e}unlinkTile(){this.linkedTile=null}isEmpty(){return!this.linkedTile}makeAnEmpty(){return e=0,this.gameScore.innerHTML=e,this.linkedTile=null}linkTileForMerge(e){e.setXY(this.x,this.y),this.linkedTileForMerge=e}unlinkTileForMerge(){this.linkedTileForMerge=null}hasTileForMerge(){return!!this.linkedTileForMerge}canAccept(e){return this.isEmpty()||!this.hasTileForMerge()&&this.linkedTile.value===e.value}mergeTiles(){if(this.linkedTile){let t=this.linkedTile.value+this.linkedTileForMerge.value;this.linkedTile.setValue(t),this.score+=t,e<this.score&&(console.log(this.score),e=this.score,this.gameScore.textContent=e),t>=2048&&document.querySelector(".message-win").classList.toggle("hidden"),this.linkedTileForMerge.removeFromDOM(),this.unlinkTileForMerge()}}}const l={2:"#eee4da",4:"#ede0c8",8:"#f2b179",16:"#f59563",32:"#f67c5f",64:"#f65e3b",128:"#edcf72",256:"#edcc61",512:"#edc850",1024:"#edc53f",2048:"#edc22e"};class i{constructor(e){this.tileElement=document.createElement("div"),this.tileElement.classList.add("tile"),this.setValue(Math.random()>.5?2:4),e.append(this.tileElement)}setValue(e){this.value=e,this.tileElement.textContent=e,this.tileElement.style.setProperty("--bg-color",`${l[e]}`),this.tileElement.style.setProperty("--text-color",`${e>=8?"#f9f6f2":"#776e65"}`)}setXY(e,t){this.x=e,this.y=t,this.tileElement.style.setProperty("--x",e),this.tileElement.style.setProperty("--y",t)}removeFromDOM(){this.tileElement.remove()}waitForTransitionEnd(){return new Promise(e=>{this.tileElement.addEventListener("transitionend",e,{once:!0})})}waitForAnimationEnd(){return new Promise(e=>{this.tileElement.addEventListener("animationend",e,{once:!0})})}}const s=document.getElementById("game-field"),r=document.querySelector(".message-lose"),n=document.querySelector(".message-start"),o=new class{constructor(e){this.cells=[];for(let l=0;l<16;l++)this.cells.push(new t(e,l%4,Math.floor(l/4)));this.score=0,this.cellsGroupedByColumn=this.groupCellsByColumn(),this.cellsGroupedByReversedColumn=this.cellsGroupedByColumn.map(e=>[...e].reverse()),this.cellsGroupedByRow=this.groupCellsByRow(),this.cellsGroupedByReversedRow=this.cellsGroupedByRow.map(e=>[...e].reverse())}getRandomEmptyCell(){let e=this.cells.filter(e=>e.isEmpty()),t=Math.floor(Math.random()*e.length);return e[t]}groupCellsByColumn(){return this.cells.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}groupCellsByRow(){return this.cells.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}moveUp(){this.slideTiles(this.cellsGroupedByColumn)}moveDown(){this.slideTiles(this.cellsGroupedByReversedColumn)}moveLeft(){this.slideTiles(this.cellsGroupedByRow)}moveRight(){this.slideTiles(this.cellsGroupedByReversedRow)}canMoveUp(){return this.canMove(this.cellsGroupedByColumn)}canMoveDown(){return this.canMove(this.cellsGroupedByReversedColumn)}canMoveLeft(){return this.canMove(this.cellsGroupedByRow)}canMoveRight(){return this.canMove(this.cellsGroupedByReversedRow)}canMove(e){return e.some(e=>this.canMoveInGroup(e))}canMoveInGroup(e){return e.some((t,l)=>!(0===l||t.isEmpty())&&e[l-1].canAccept(t.linkedTile))}slideTiles(e){let t=[];e.forEach(e=>this.slideTilesInGroup(e,t)),Promise.all(t),this.cells.forEach(e=>{e.hasTileForMerge()&&e.mergeTiles()})}slideTilesInGroup(e,t){for(let l=1;l<e.length;l++){let i;if(e[l].isEmpty())continue;let s=e[l],r=l-1;for(;r>=0&&e[r].canAccept(s.linkedTile);)i=e[r],r--;i&&(t.push(s.linkedTile.waitForTransitionEnd()),i.isEmpty()?i.linkTile(s.linkedTile):i.linkTileForMerge(s.linkedTile),s.unlinkTile())}}start(e){this.getRandomEmptyCell().linkTile(new i(e)),this.getRandomEmptyCell().linkTile(new i(e))}restart(){document.querySelectorAll(".tile").forEach(e=>{e.remove()}),this.cells.forEach(e=>e.unlinkTile())}}(s);function c(){document.addEventListener("keydown",a,{once:!0})}function a(e){switch(e.key){case"ArrowUp":if(!o.canMoveUp()){c();return}o.moveUp();break;case"ArrowDown":if(!o.canMoveDown()){c();return}o.moveDown();break;case"ArrowLeft":if(!o.canMoveLeft()){c();return}o.moveLeft();break;case"ArrowRight":if(!o.canMoveRight()){c();return}o.moveRight();break;default:c();return}let t=new i(s);if(o.getRandomEmptyCell().linkTile(t),!o.canMoveUp()&&!o.canMoveDown()&&!o.canMoveLeft()&&!o.canMoveRight()){t.waitForAnimationEnd(),r.classList.toggle("hidden");return}c()}const h=document.querySelector(".button");h.addEventListener("click",()=>{h.classList.contains("start")?(o.start(s),c(),h.classList.replace("start","restart"),h.textContent="Restart"):(o.restart(),h.classList.replace("restart","start"),h.textContent="Start"),n.classList.toggle("hidden")});
//# sourceMappingURL=index.07bbea65.js.map
